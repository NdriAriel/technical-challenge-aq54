"use strict";(self.webpackChunkaq54=self.webpackChunkaq54||[]).push([[386],{4386:(Y,Z,g)=>{g.r(Z),g.d(Z,{FeaturesModule:()=>A});var I=g(8583),$=g(7991),m=g(8239),v=g(4123),C=g(6738),r=g(556),f=g(639),x=g(576);const O=[{component:(()=>{class d{constructor(e,t){this.usecases=e,this.activeRoute=t,this.scatters=[],this.times=[],this.scatterChart=null,this.stationsInfo=[],this.stations=[],this.selectedStation="SMART188",this.sensors=[],this.ranges={start:C().subtract(1,"days").format("YYYY-MM-DD"),end:C().format("YYYY-MM-DD")},this.title="AQ54",this.data={labels:["January","February","March","April"],type:"line",datasets:[{type:"bar",label:"Bar Dataset",data:[13,20,30,40],borderColor:"rgb(255, 99, 132)",backgroundColor:`${(0,r.wo)()}`},{type:"bar",label:"Line Dataset",data:[50,50,50,50],fill:!1,borderColor:`${(0,r.wo)()}`}],options:{animations:{tension:{duration:1e3,easing:"linear",from:1,to:0,loop:!0}},scales:{y:{beginAtZero:!0,min:0}}}},this.timeData=[]}ngOnInit(){var e=this;return(0,m.Z)(function*(){e.activeRoute.queryParams.subscribe(function(){var t=(0,m.Z)(function*(s){const{station:i,start:o,end:a}=s;i&&o&&a?(e.ranges.end=a,e.ranges.start=o,e.builder(i)):i?e.builder(i):e.builder()});return function(s){return t.apply(this,arguments)}}())})()}builder(e=""){var t=this;return(0,m.Z)(function*(){try{if(e){const{raw_data:s,station:i,sessionInfo:o}=yield t.usecases.parallelExecution(e,t.ranges.start,t.ranges.end,t.title);t.selectedStation=i,t.stationsInfo=o,t.stations=t.stationsInfo.map(n=>({station:n.station,selected:n.station==t.selectedStation}));const a=(0,r.UJ)(s,t.stationsInfo[1].integrated_sensors);t.chartData(a)}else{const{raw_data:s,station:i,sessionInfo:o}=yield t.usecases.execute(t.ranges.start,t.ranges.end,t.title);t.stationsInfo=o,t.stations=t.stationsInfo.map((n,l)=>({station:n.station,selected:0==l})),t.selectedStation=i;const a=(0,r.UJ)(s,t.stationsInfo[1].integrated_sensors);t.chartData(a)}t.timeChart(),setInterval(()=>{t.updateScatter()},5e4)}catch(s){throw new Error(s.message)}})()}chartData(e=[]){const t=(0,r.El)(this.stationsInfo);this.data.labels=t;const s=(0,r.c8)(e,t),i=(0,r.U4)(s);this.data.datasets=i,this.timeData=i,this.timeData=this.timeData.map(a=>Object.assign(Object.assign({},a),{group:Object.entries((0,r.vM)(this.timeData,n=>n.unit)).map(n=>({unit:n[0],values:n[1],label:a.label}))}));const o=[];this.timeData.forEach((a,n)=>{const l=a.group.find(p=>p.unit===a.unit&&!o.find(M=>M==p.unit)),c=a.group.find(p=>p.unit===a.unit),u=c?c.values.find(p=>p.label===a.label):null,h=c?c.values.filter(p=>p.label!=a.label&&p.unit===a.unit):[],D=(0,r.vM)(h,p=>p.label);if(h.length&&u){let p=(0,r.vM)(u.dayValues,b=>b.x),T=Object.entries(D).map(b=>({label:b[0],ydata:(0,r.vM)(b[1][0].dayValues,w=>w.x)})),S=[];Object.keys(p).forEach(b=>{T.forEach(w=>{p[b].forEach((F,R)=>{S.push({data:{y:w.ydata[b][R].y,x:F.y},label:`${w.label}=f(${a.label})`})})})}),a.dayVal=(0,r.vM)(S,b=>b.label)}o.push(null==l?void 0:l.unit),null==l||l.values.forEach(p=>{a.gunit=p.unit,a.dayData=a.dayData?a.dayData.concat(p.dayValues):p.dayValues,a.monthData=a.monthData?a.monthData.concat(p.monthDays):p.monthDays})})}updateScatter(){const e=this.timeData.filter(s=>s.dayVal),t=e[Math.floor(Math.random()*(e.length-1))];if(t){const s={type:"scatter",data:{datasets:Object.entries(t.dayVal).map(i=>({data:i[1].map(a=>Object.assign({},a.data)),label:i[0]})),backgroundColor:(0,r.wo)()},options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:`Correlation entre les donn\xe9s d'un capteur pris de fa\xe7on aleatoire dans ${this.selectedStation} et le reste des capteurs selon l'unit\xe9 de mesure ${t.unit}. et le temps de transmission des donn\xe9es.`}},scales:{y:{type:"linear",beginAtZero:!0,title:{display:!0,text:`autres capteurs(${t.unit})`},position:"left",ticks:{color:(0,r.wo)()}},x:{type:"linear",position:"bottom",beginAtZero:!0,title:{display:!0,text:`${t.label}(${t.unit})`},ticks:{color:(0,r.wo)()}}}}};this.scatterChart.options=s.options,this.scatterChart.data=s.data,this.scatterChart.update()}}timeChart(){try{const t=C(this.ranges.end).diff(C(this.ranges.start),"days")>=30,s=C(this.ranges.start).toLocaleString().split(" ");var e=`${s[1]}/${s[3]}`;t||(e=`${s[2]}/${s[1]}`);const i={type:"bar",data:{datasets:this.timeData.filter(n=>n.gunit).map(n=>({data:t?n.monthData:n.dayData,backgroundColor:(0,r.wo)(),borderColor:(0,r.wo)(),label:`${n.gunit}`,fill:!1,tension:.8}))},options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:`Distribution temporelle des donn\xe9es selon le type de capteur  dans la station ${this.selectedStation}`}},scales:{x:{min:e}}}};new v.ZP("chart",i);const o=this.timeData.filter(n=>n.dayVal),a=o[Math.floor(Math.random()*(o.length-1))];if(a){const n={type:"scatter",data:{datasets:Object.entries(a.dayVal).map(l=>({data:l[1].map(u=>Object.assign({},u.data)),label:l[0]})),backgroundColor:(0,r.wo)()},options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:`Correlation entre les donn\xe9s d'un capteur pris de fa\xe7on aleatoire dans ${this.selectedStation} et le reste des capteurs selon l'unit\xe9 de mesure ${a.unit}. et le temps de transmission des donn\xe9es.`}},scales:{y:{type:"linear",beginAtZero:!0,title:{display:!0,text:`autres capteurs(${a.unit})`},position:"left",ticks:{color:(0,r.wo)()}},x:{type:"linear",position:"bottom",beginAtZero:!0,title:{display:!0,text:`${a.label}(${a.unit})`},ticks:{color:(0,r.wo)()}}}}};this.scatters.push("sc"),setTimeout(()=>{this.scatterChart=new v.ZP("sc",n)},1e3)}}catch(t){throw new Error(t.message)}}}return d.\u0275fac=function(e){return new(e||d)(f.Y36("diferred:mode"),f.Y36($.gz))},d.\u0275cmp=f.Xpm({type:d,selectors:[["app-diferred-data-chart"]],decls:1,vars:5,consts:[[3,"selectedStation","scatters","times","stations","chart"]],template:function(e,t){1&e&&f._UZ(0,"app-charts",0),2&e&&f.Q6J("selectedStation",t.selectedStation)("scatters",t.scatters)("times",t.times)("stations",t.stations)("chart","chart")},directives:[x.Z],styles:[""]}),d})(),path:"diferred"},{component:(()=>{class d{constructor(e){this.usecases=e,this.sensors=[],this.scatters=[],this.scatterChart=[],this.times=[],this.timeData=[],this.timesCahrt=[],this.title="AQ54",this.time="",this.data={labels:["January","February","March","April"],datasets:[{type:"bar",label:"Bar Dataset",data:[13,20,30,40],borderColor:"rgb(255, 99, 132)",backgroundColor:`${(0,r.wo)()}`},{type:"bar",label:"Line Dataset",data:[50,50,50,50],fill:!1,borderColor:`${(0,r.wo)()}`}],options:{animations:{tension:{duration:1e3,easing:"linear",from:1,to:0,loop:!0}},scales:{y:{beginAtZero:!0,min:0,max:100}}}},this.stations=[]}ngOnDestroy(){clearInterval(this.time)}ngOnInit(){var e=this;return(0,m.Z)(function*(){try{yield e.onChartsInit(),e.time=setInterval((0,m.Z)(function*(){e.stations.forEach(function(){var t=(0,m.Z)(function*(s){(yield e.usecases.canUpdate(s.sessiond_id))&&e.updateData(s)});return function(s){return t.apply(this,arguments)}}())}),1e3)}catch(t){throw new Error(t.message)}})()}initChartBar(){return new v.ZP("real-time-chart",{data:this.data,options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Distribution des donn\xe9es selon les types de capteurs par station."}}}})}initScatter(e=[]){var t=this.scatterData(e);t.length||(t=this.scatterData(e,4));for(let s=0;s<this.scatters.length;s++){const i={type:"scatter",data:t[s],station:t[s].station,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:`Correlation entre les donn\xe9s d'un capteur pris de fa\xe7on aleatoire dans ${t[s].station} et le reste des capteurs selon l'unit\xe9 de mesure (${t[s].unit}).`}},scales:{y:{type:"linear",beginAtZero:!0,title:{display:!0,text:`${t[s].sensors.join(",")}(${t[s].unit})`},position:"left",ticks:{color:(0,r.wo)()}},x:{type:"linear",position:"bottom",beginAtZero:!0,title:{display:!0,text:`${t[s].sensor}(${t[s].unit})`},ticks:{color:(0,r.wo)()}}}}};setTimeout(()=>this.scatterChart.push({config:i,chart:new v.ZP(document.getElementById(this.scatters[s]),i)}),100)}}updateScatter(e=[],t=""){var s=this;return(0,m.Z)(function*(){var i,o;try{const n=s.scatterData(e);if(n.length){const{chart:l}=s.scatterChart.find(c=>c.config.station===t);l.config.data.datasets.forEach(c=>{const u=n[0].datasets.find(h=>h.label===c.label);u&&(c.data=c.data.concat(u.data))}),l.config.options={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:`Correlation entre les donn\xe9s d'un capteur pris de fa\xe7on aleatoire dans ${null===(i=n[0])||void 0===i?void 0:i.station} et le reste des capteurs selon l'unit\xe9 de mesure (${null===(o=n[0])||void 0===o?void 0:o.unit}).`}},scales:{y:{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:`${n[0].sensors.join(",")}(${n[0].unit})`},ticks:{color:(0,r.wo)()}},x:{type:"linear",title:{display:!0,text:`${n[0].sensor}(${n[0].unit})`},beginAtZero:!0,position:"bottom",ticks:{color:(0,r.wo)()}}}},l.update()}}catch(a){throw new Error(a.message)}})()}scatterData(e,t=null){let s=[];const i=this.selectedSensor?this.selectedSensor:this.sensors[t||Math.floor(Math.random()*(this.sensors.length-1))];i&&e.forEach(a=>{const n=a.values.filter(c=>{var u;return c.unit?c.unit.toLowerCase()===(null===(u=i.unit)||void 0===u?void 0:u.toLowerCase())&&c.sensor!=i.type:null}),l=a.values.find(c=>c.sensor.toLowerCase()===i.type.toLowerCase());l&&n.length&&s.push({datasets:n.map(c=>({data:[{x:l.value,y:c.value}],label:`${c.sensor}=f(${l.sensor})`})),backgroundColor:(0,r.wo)(),station:a.station_name,unit:null==l?void 0:l.unit,sensor:l.sensor,sensors:n.map(c=>c.sensor)})});let o=[];for(let a=0;a<s.length;a++)o.push(Date.now()+"scattter"+a);return 0==this.scatterChart.length&&(this.scatters=o),s}onChartsInit(){var e=this;return(0,m.Z)(function*(){const t=yield e.chartData();e.chart=e.initChartBar(),e.OntimeSerieChartInit(t),e.initScatter(t)})()}chartData(){var e=this;return(0,m.Z)(function*(){try{const{stations:t,sessionInfo:s}=yield e.usecases.Oninit(e.title);e.stations=s,e.sensors=s[0].integrated_sensors,e.data.labels=(0,r.El)(s);const o=(0,r.Uf)(t,e.data.labels);return e.data.datasets=o,t}catch(t){throw new Error(t.message)}})()}updateData(e){var t=this;return(0,m.Z)(function*(){try{const s=yield t.usecases.OnUpdate(e.station),i=(0,r.Ng)([s],t.data.labels);t.chart.config.data.datasets.filter(o=>o.label===e.station).forEach((o,a)=>{var n;i.find(l=>l.station==o.label)?o.data=null===(n=i.find(l=>l.station==o.label))||void 0===n?void 0:n.data:t.chart.config.data.datasets.splice(a,1)}),t.chart.update(),t.updateTimeSeries(s,e.station),t.updateScatter([s],e.station)}catch(s){throw new Error(s.message)}})()}updateTimeSeries(e,t){var s=this;return(0,m.Z)(function*(){const a=[e].map(u=>({time:u.timestamp,station:u.station_name,values:(0,r.vM)(u.values,h=>h.unit)})).map(u=>Object.assign(Object.assign({},u),{values:Object.entries(u.values).map(h=>h[1])})),{chart:n}=s.timesCahrt.find(u=>u.config.station===t),l={type:"bar",time:a[0].time,data:{datasets:a[0].values.map(u=>({data:u.map(h=>({y:h.value,x:a[0].time})),label:`(${u[0].unit})`,backgroundColor:(0,r.wo)()}))},options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:`Distribution temporelle des donn\xe9es selon l'unit\xe9 de mesure dans la station ${a[0].station}`}}}};n.config.options.plugins=l.options.plugins;var c=!1;l.data.datasets.forEach(u=>{const h=n.config.data.datasets.find(D=>u.label===D.label);c=!(!h||h.data.find(D=>D.x===a[0].time))&&h.data.push(...u.data)}),c&&n.update()})()}OntimeSerieChartInit(e){var t=this;return(0,m.Z)(function*(){let i=e.map(o=>({time:o.timestamp,station:o.station_name,values:(0,r.vM)(o.values,a=>a.unit)}));i=i.map(o=>Object.assign(Object.assign({},o),{values:Object.entries(o.values).map(a=>a[1])})),i.forEach((o,a)=>{t.times.push(a+"times"+Date.now());const n={type:"line",time:o.time,station:o.station,data:{datasets:o.values.map(l=>({data:l.map(c=>({y:c.value,x:o.time})),label:`(${l[0].unit})`,backgroundColor:(0,r.wo)(),borderColor:(0,r.wo)(),fill:!1,tension:.8}))},options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:`Distribution temporelle des donn\xe9es selon l'unit\xe9 de mesure dans la station ${o.station}`}},scales:{x:{min:o.time},y:{min:0}}}};setTimeout(()=>{let l=new v.ZP(t.times[a],n);t.timesCahrt.push({chart:l,config:n})},1e3)})})()}}return d.\u0275fac=function(e){return new(e||d)(f.Y36("realTime:mode"))},d.\u0275cmp=f.Xpm({type:d,selectors:[["app-real-time-chart"]],decls:1,vars:2,consts:[[3,"scatters","times"]],template:function(e,t){1&e&&f._UZ(0,"app-charts",0),2&e&&f.Q6J("scatters",t.scatters)("times",t.times)},directives:[x.Z],styles:[""]}),d})(),path:"real-time"}];let j=(()=>{class d{}return d.\u0275fac=function(e){return new(e||d)},d.\u0275mod=f.oAB({type:d}),d.\u0275inj=f.cJS({imports:[[$.Bz.forChild(O)],$.Bz]}),d})();var E=g(3704);let A=(()=>{class d{}return d.\u0275fac=function(e){return new(e||d)},d.\u0275mod=f.oAB({type:d}),d.\u0275inj=f.cJS({imports:[[I.ez,j,E.m8]]}),d})()}}]);